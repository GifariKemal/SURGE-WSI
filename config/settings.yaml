# SURGE-WSI Configuration
# 6-Layer Quantitative Trading System

# ============================================
# Layer 1: Kalman Filter (Noise Reduction)
# ============================================
kalman:
  # Fast filter - responsive to quick changes
  fast_process_noise: 0.05
  fast_measurement_noise: 0.05

  # Medium filter - balanced
  medium_process_noise: 0.01
  medium_measurement_noise: 0.1

  # Slow filter - smooth trend
  slow_process_noise: 0.001
  slow_measurement_noise: 0.2

# ============================================
# Layer 2: HMM Regime Detection
# ============================================
regime:
  n_states: 3            # BULLISH, BEARISH, SIDEWAYS
  lookback: 50           # Bars for feature calculation
  min_samples: 100       # Minimum samples before training
  retrain_every: 200     # Retrain model every N updates
  min_probability: 0.6   # Minimum probability to act

# ============================================
# Layer 3: Kill Zone (Time Filter)
# ============================================
killzone:
  enabled: true

  # London Session (UTC)
  london_start: 8
  london_end: 12

  # New York Session (UTC)
  new_york_start: 13
  new_york_end: 17

  # London Close (overlap)
  london_close_start: 15
  london_close_end: 17

# ============================================
# Layer 3b: Dynamic Activity Filter (Hybrid)
# ============================================
# Market Filter Settings (Trend + Relaxed Entry)
# Backtest shows KZ-only performs better than Hybrid Mode
# Hybrid Mode removed - added Trend Filter + Relaxed Entry instead
market_filter:
  enabled: true
  trend_threshold: 0.6        # 60% directional bars = trending
  min_volatility_pips: 15.0   # Min ATR to trade
  max_volatility_pips: 80.0   # Max ATR (too risky)
  atr_period: 14              # Period for ATR calculation
  lookback_bars: 20           # Bars to analyze for trend

# Relaxed Entry Filter - relax filters in low-activity periods
# DISABLED for Zero Losing Months strategy (tighter control = better)
relaxed_entry:
  enabled: false              # Disabled - we need strict quality control
  min_quality_normal: 65.0    # Higher normal quality
  min_quality_relaxed: 60.0   # Relaxed quality (no recent trades)
  require_full_confirmation_normal: true
  require_full_confirmation_relaxed: true  # Always require full confirmation

  # Time settings
  skip_weekends: true
  skip_friday_late: true      # Avoid Friday after 20:00 UTC
  boost_overlap_hours: true   # Bonus during London-NY overlap

  # Zero Losing Months note:
  # Backtest shows strict filters prevent large losses
  # Better to miss trades than have losing months

# ============================================
# Layer 4: POI Detection (Order Blocks + FVG)
# ============================================
poi:
  swing_length: 10       # Bars for swing detection
  ob_min_strength: 0.6   # Minimum Order Block strength
  fvg_min_pips: 3.0      # Minimum FVG size in pips
  max_poi_age_bars: 100  # Maximum age for valid POI

  # Feature toggles
  use_order_blocks: true
  use_fvg: true
  use_bos: true          # Break of Structure

# ============================================
# Layer 5: Entry Trigger (LTF Confirmation)
# ============================================
entry:
  swing_length: 3        # LTF swing detection bars
  sweep_min_pips: 2.0    # Minimum liquidity sweep distance
  mss_lookback: 10       # MSS detection lookback
  fvg_min_pips: 1.0      # LTF FVG minimum size
  min_quality_score: 75.0  # ZERO LOSING MONTHS: Higher quality threshold
  max_sl_pips: 10.0      # ZERO LOSING MONTHS: Maximum stop loss (was 50)
  rejection_wick_ratio: 0.5  # Wick > 50% of candle body

# ============================================
# Layer 6: Exit Management
# ============================================
exit:
  # Partial Take Profit Strategy
  tp1_rr: 1.0            # TP1 at 1:1 R:R
  tp1_percent: 0.5       # Close 50% at TP1

  tp2_rr: 2.0            # TP2 at 2:1 R:R
  tp2_percent: 0.3       # Close 30% at TP2

  tp3_rr: 3.0            # TP3 at 3:1 R:R
  tp3_percent: 0.2       # Close remaining 20%

  # Trailing Stop
  trailing_enabled: true
  trailing_start_rr: 1.5 # Start trailing after 1.5R
  trailing_step_pips: 10.0

  # Breakeven
  move_sl_to_be_at_tp1: true

# ============================================
# Risk Management
# ============================================
risk:
  # Position sizing by zone quality
  high_quality_threshold: 80.0   # Quality >= 80%
  high_quality_risk: 0.015       # Risk 1.5%

  medium_quality_threshold: 60.0 # Quality >= 60%
  medium_quality_risk: 0.01      # Risk 1.0%

  low_quality_risk: 0.005        # Risk 0.5%

  # Daily limits
  daily_profit_target: 100.0
  daily_loss_limit: 80.0         # 0.8% of $10K = $80 daily loss limit
  max_open_positions: 1

  # Per trade limits - ZERO LOSING MONTHS CONFIG
  max_lot_size: 0.5              # Conservative base for zero-loss strategy
  min_lot_size: 0.01             # Min lot size (broker minimum)
  min_sl_pips: 15.0              # Minimum SL distance (prevents overleveraging)
  max_sl_pips: 10.0              # ZERO LOSING MONTHS: Maximum SL distance (was 50)

  # ZERO LOSING MONTHS: Max loss per trade protection
  max_loss_per_trade_pct: 0.1    # ZERO LOSING MONTHS: Maximum 0.1% loss per trade (was 0.8)
  monthly_loss_stop_pct: 2.0     # Stop trading if monthly loss > 2%

# ============================================
# Adaptive Risk Management
# ============================================
# Automatically adjusts risk based on market conditions
# Tuned for GBPUSD (typically 25-35 ATR)
# UPDATED: Zero Losing Months Configuration
adaptive_risk:
  enabled: true

  # Base settings (zero-loss strategy)
  base_max_lot: 0.5              # Conservative base for protection
  base_risk_percent: 0.008       # 0.8% max risk per trade

  # Volatility thresholds (ATR in pips) - tuned for GBPUSD
  low_volatility_atr: 12.0       # ATR < 12 = low vol (reduce lot)
  high_volatility_atr: 40.0      # ATR > 40 = high vol (reduce lot)
  extreme_volatility_atr: 55.0   # ATR > 55 = extreme (heavily reduce)

  # Performance tracking
  consecutive_loss_threshold: 2  # 2 losses = reduce risk (stricter)
  drawdown_threshold: 0.08       # 8% DD = reduce risk 50% (stricter)

  # Time-based adjustments
  friday_close_reduction: 0.5    # 50% reduction after Friday 18:00 UTC
  december_reduction: 0.1        # 90% reduction Dec 15-31 (almost no trading)

  # December special settings (anomaly month)
  # December historically has 12.5% win rate - essentially skip it
  skip_december: true            # Skip trading entirely in December
  december_max_lot: 0.01         # If not skipping, use minimal lot
  december_min_quality: 99.0     # If not skipping, impossible quality

# ============================================
# Trading Settings
# ============================================
trading:
  symbol: "GBPUSD"
  magic_number: 20250125
  enabled: false
  mode: "demo"           # demo or live

  # Timeframes
  timeframe_htf: "H4"    # Higher timeframe for POI
  timeframe_ltf: "M5"    # Lower timeframe for entry

  # Constants
  pip_value: 10.0        # USD per pip per lot

# ============================================
# Telegram Settings
# ============================================
telegram:
  enabled: true
  # Commands: /status, /balance, /positions, /regime, /pois
  # Admin: /pause, /resume, /close_all

# ============================================
# Database Settings
# ============================================
database:
  # Tables:
  # - ohlcv: Price data (hypertable)
  # - signals: Generated signals
  # - trades: Executed trades
  # - regimes: Regime history
  retention_days: 365
  chunk_interval: "7 days"
